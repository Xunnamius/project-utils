/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the *.babel.js version of
* ! this file to make permanent modifications (in config/)
*/

"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.cleanTypes = exports.regenerate = exports.eject = void 0;

require("source-map-support/register");

var _fs = require("fs");

var _util = require("util");

var _gulp = _interopRequireDefault(require("gulp"));

var _gulpTap = _interopRequireDefault(require("gulp-tap"));

var _del = _interopRequireDefault(require("del"));

var _fancyLog = _interopRequireDefault(require("fancy-log"));

var _parseGitignore = _interopRequireDefault(require("parse-gitignore"));

var _core = require("@babel/core");

var _path = require("path");

var _inquirer = _interopRequireDefault(require("inquirer"));

var _replaceInFile = _interopRequireDefault(require("replace-in-file"));

var _shelljs = _interopRequireDefault(require("shelljs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const paths = {};
const FLOW_TYPES_DIR = 'flow-typed';
paths.flowTypedGitIgnore = `${FLOW_TYPES_DIR}/.gitignore`;
paths.configs = 'config';
paths.packageJson = 'package.json';
paths.launchJson = '.vscode/launch.json';
paths.launchJsonDist = '.vscode/launch.dist.json';
paths.env = '.env';
paths.envDist = 'dist.env';
paths.gitProjectDir = '.git';
paths.gitIgnore = '.gitignore';
paths.packageLockJson = 'package-lock.json';
paths.regenTargets = [`${paths.configs}/*.js`];
const CLI_BANNER = `/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the *.babel.js version of
* ! this file to make permanent modifications (in config/)
*/\n\n`;
const readFileAsync = (0, _util.promisify)(_fs.readFile);

const cleanTypes = async () => {
  const targets = (0, _parseGitignore.default)((await readFileAsync(paths.flowTypedGitIgnore)));
  (0, _fancyLog.default)(`Deletion targets @ ${FLOW_TYPES_DIR}/: "${targets.join('" "')}"`);
  (0, _del.default)(targets, {
    cwd: FLOW_TYPES_DIR
  });
};

exports.cleanTypes = cleanTypes;
cleanTypes.description = `Resets the ${FLOW_TYPES_DIR} directory to a pristine state`;

const regenerate = () => {
  (0, _fancyLog.default)(`Regenerating targets: "${paths.regenTargets.join('" "')}"`);
  process.env.BABEL_ENV = 'generator';
  return _gulp.default.src(paths.regenTargets).pipe((0, _gulpTap.default)(file => file.contents = Buffer.from(CLI_BANNER + (0, _core.transformSync)(file.contents.toString(), {
    sourceFileName: (0, _path.relative)(__dirname, file.path)
  }).code))).pipe(_gulp.default.dest('.'));
};

exports.regenerate = regenerate;
regenerate.description = 'Invokes babel on the files in config, transpiling them into their project root versions';

const eject = () => _inquirer.default.prompt([{
  type: 'input',
  name: 'package.name',
  message: '[package.json] Specify name for this project (must be valid as a directory name)'
}, {
  type: 'input',
  name: 'package.desc',
  message: '[package.json] Very briefly describe this project'
}, {
  type: 'input',
  name: 'package.repo.url',
  message: '[package.json] Specify a git repository URL'
}, {
  type: 'input',
  name: 'debug.address',
  message: '[launch.json] Specify your dev/remote/server ip address (the one running node)',
  default: '192.168.115.5'
}, {
  type: 'input',
  name: 'debug.url',
  message: '[launch.json] Specify the URL entry point for your application',
  default: 'http://dev.local:80'
}, {
  type: 'input',
  name: 'debug.remoteRoot',
  message: "[launch.json] Specify an *absolute* path to this project's root on remote/server"
}, {
  type: 'confirm',
  name: 'installTypes',
  message: 'Do you want to install Flow types for all local packages?',
  default: true
}, {
  type: 'confirm',
  name: 'confirm',
  message: 'Does everything look good?',
  default: false
}]).then(answers => {
  if (!answers.confirm) return _fancyLog.default.error('Task aborted!');

  try {
    _shelljs.default.mv(paths.envDist, paths.env);

    _shelljs.default.mv(paths.launchJsonDist, paths.launchJson);

    const delta1 = (0, _replaceInFile.default)({
      files: paths.packageJson,
      from: [/("name": ?)".*?"/g, /("description": ?)".*?"/g, /("url": ?)".*?"/g],
      to: [`$1"${answers.package.name}"`, `$1"${answers.package.desc}"`, `$1"${answers.package.repo.url}"`]
    });
    const delta2 = (0, _replaceInFile.default)({
      files: paths.launchJson,
      from: [/("address": ?)".*?"/g, /("remoteRoot": ?)".*?"/g, /("url": ?)".*?"/g],
      to: [`$1"${answers.debug.address}"`, `$1"${answers.debug.remoteRoot}"`, `$1"${answers.debug.url}"`]
    });
    const delta3 = (0, _replaceInFile.default)({
      files: paths.gitIgnore,
      from: 'package-lock.json',
      to: ''
    });
    if (!delta1.length) throw new Error(`There was an error attempting to access "${paths.packageJson}"`);
    if (!delta2.length) throw new Error(`There was an error attempting to access "${paths.launchJson}"`);
    if (!delta3.length) throw new Error(`There was an error attempting to access "${paths.gitignore}"`);
    if (answers.installTypes) (0, _shelljs.default)('npm run install-types');

    _shelljs.default.rm('-f', paths.packageLockJson);

    _shelljs.default.echo("sh.rm('-f', '.git');");

    _shelljs.default.echo("sh('git init');");

    (0, _shelljs.default)(`cd .. && mv '${(0, _path.parse)(__dirname).name}' '${answers.package.name}'`);

    _fancyLog.default.info('Boilerplate ejection complete!');

    (0, _fancyLog.default)(`Next steps:\n\t- If you're going to host this project on Github/Gitlab, begin that process now\n\t- Check over package.json for accuracy; remove any unnecessary dependencies/devDependencies\n\t- Look over .env and configure it to your liking\n`);
  } catch (err) {
    _fancyLog.default.error(`ERROR: ${err.toString()}`);
  }
});

exports.eject = eject;
eject.description = 'Assists in configuring the boilerplate to be something useful';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbmZpZy9ndWxwZmlsZS5qcyJdLCJuYW1lcyI6WyJwYXRocyIsIkZMT1dfVFlQRVNfRElSIiwiZmxvd1R5cGVkR2l0SWdub3JlIiwiY29uZmlncyIsInBhY2thZ2VKc29uIiwibGF1bmNoSnNvbiIsImxhdW5jaEpzb25EaXN0IiwiZW52IiwiZW52RGlzdCIsImdpdFByb2plY3REaXIiLCJnaXRJZ25vcmUiLCJwYWNrYWdlTG9ja0pzb24iLCJyZWdlblRhcmdldHMiLCJDTElfQkFOTkVSIiwicmVhZEZpbGVBc3luYyIsInJlYWRGaWxlIiwiY2xlYW5UeXBlcyIsInRhcmdldHMiLCJqb2luIiwiY3dkIiwiZGVzY3JpcHRpb24iLCJyZWdlbmVyYXRlIiwicHJvY2VzcyIsIkJBQkVMX0VOViIsImd1bHAiLCJzcmMiLCJwaXBlIiwiZmlsZSIsImNvbnRlbnRzIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwic291cmNlRmlsZU5hbWUiLCJfX2Rpcm5hbWUiLCJwYXRoIiwiY29kZSIsImRlc3QiLCJlamVjdCIsInRlcm0iLCJwcm9tcHQiLCJ0eXBlIiwibmFtZSIsIm1lc3NhZ2UiLCJkZWZhdWx0IiwidGhlbiIsImFuc3dlcnMiLCJjb25maXJtIiwibG9nIiwiZXJyb3IiLCJzaCIsIm12IiwiZGVsdGExIiwiZmlsZXMiLCJ0byIsInBhY2thZ2UiLCJkZXNjIiwicmVwbyIsInVybCIsImRlbHRhMiIsImRlYnVnIiwiYWRkcmVzcyIsInJlbW90ZVJvb3QiLCJkZWx0YTMiLCJsZW5ndGgiLCJFcnJvciIsImdpdGlnbm9yZSIsImluc3RhbGxUeXBlcyIsInJtIiwiZWNobyIsImluZm8iLCJlcnIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQVNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsTUFBTUEsS0FBSyxHQUFHLEVBQWQ7QUFDQSxNQUFNQyxjQUFjLEdBQUcsWUFBdkI7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RUFBWW5FLEtBQUssQ0FBQ1csZUFBbEI7O0FBRUFzQyxxQkFBR21CLElBQUgsQ0FBUSxzQkFBUjs7QUFFQW5CLHFCQUFHbUIsSUFBSCxDQUFRLGlCQUFSOztBQUVBLDBCQUFJLGdCQUFlLGlCQUFVbkMsU0FBVixFQUFxQlEsSUFBSyxNQUFLSSxPQUFPLENBQUNTLE9BQVIsQ0FBZ0JiLElBQUssR0FBdkU7O0FBRUFNLHNCQUFJc0IsSUFBSixDQUFTLGdDQUFUOztBQUNBLDJCQUFLLHFQQUFMO0FBQ0gsR0E1Q0QsQ0E4Q0EsT0FBTUMsR0FBTixFQUFXO0FBQ1B2QixzQkFBSUMsS0FBSixDQUFXLFVBQVNzQixHQUFHLENBQUN2QyxRQUFKLEVBQWUsRUFBbkM7QUFDSDtBQUNKLENBbEdtQixDQUFwQjs7O0FBb0dBTSxLQUFLLENBQUNqQixXQUFOLEdBQW9CLCtEQUFwQiIsInNvdXJjZXNDb250ZW50IjpbIi8qIEBmbG93ICovXG5cbi8vID8gVG8gcmVnZW5lcmF0ZSB0aGlzIGZpbGUgKGkuZS4gaWYgeW91IGNoYW5nZWQgaXQgYW5kIHdhbnQgeW91ciBjaGFuZ2VzIHRvXG4vLyA/IGJlIHBlcm1hbmVudCksIGNhbGwgYG5wbSBydW4gcmVnZW5lcmF0ZWAgYWZ0ZXJ3YXJkc1xuXG4vLyAhIEJlIHN1cmUgdGhhdCB0YXNrcyBleHBlY3RlZCB0byBydW4gb24gbnBtIGluc3RhbGwgKG1hcmtlZCBAZGVwZW5kZW50KSBoYXZlXG4vLyAhIGFsbCByZXF1aXJlZCBwYWNrYWdlcyBsaXN0ZWQgdW5kZXIgXCJkZXBlbmRlbmNpZXNcIiBpbnN0ZWFkIG9mXG4vLyAhIFwiZGV2RGVwZW5kZW5jaWVzXCIgaW4gdGhpcyBwcm9qZWN0J3MgcGFja2FnZS5qc29uXG5cbmltcG9ydCB7IHJlYWRGaWxlIH0gZnJvbSAnZnMnXG5pbXBvcnQgeyBwcm9taXNpZnkgfSBmcm9tICd1dGlsJ1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCdcbmltcG9ydCB0YXAgZnJvbSAnZ3VscC10YXAnXG5pbXBvcnQgZGVsIGZyb20gJ2RlbCdcbmltcG9ydCBsb2cgZnJvbSAnZmFuY3ktbG9nJ1xuaW1wb3J0IHBhcnNlR2l0SWdub3JlIGZyb20gJ3BhcnNlLWdpdGlnbm9yZSdcbmltcG9ydCB7IHRyYW5zZm9ybVN5bmMgYXMgYmFiZWwgfSBmcm9tICdAYmFiZWwvY29yZSdcbmltcG9ydCB7IHBhcnNlIGFzIHBhcnNlUGF0aCwgcmVsYXRpdmUgYXMgcmVsUGF0aCB9IGZyb20gJ3BhdGgnXG5pbXBvcnQgdGVybSBmcm9tICdpbnF1aXJlcidcbmltcG9ydCByZXBsYWNlSW5GaWxlIGZyb20gJ3JlcGxhY2UtaW4tZmlsZSdcbmltcG9ydCBzaCBmcm9tICdzaGVsbGpzJ1xuXG5jb25zdCBwYXRocyA9IHt9O1xuY29uc3QgRkxPV19UWVBFU19ESVIgPSAnZmxvdy10eXBlZCc7XG5cbnBhdGhzLmZsb3dUeXBlZEdpdElnbm9yZSA9IGAke0ZMT1dfVFlQRVNfRElSfS8uZ2l0aWdub3JlYDtcbnBhdGhzLmNvbmZpZ3MgPSAnY29uZmlnJztcbnBhdGhzLnBhY2thZ2VKc29uID0gJ3BhY2thZ2UuanNvbic7XG5wYXRocy5sYXVuY2hKc29uID0gJy52c2NvZGUvbGF1bmNoLmpzb24nO1xucGF0aHMubGF1bmNoSnNvbkRpc3QgPSAnLnZzY29kZS9sYXVuY2guZGlzdC5qc29uJztcbnBhdGhzLmVudiA9ICcuZW52JztcbnBhdGhzLmVudkRpc3QgPSAnZGlzdC5lbnYnO1xucGF0aHMuZ2l0UHJvamVjdERpciA9ICcuZ2l0JztcbnBhdGhzLmdpdElnbm9yZSA9ICcuZ2l0aWdub3JlJztcbnBhdGhzLnBhY2thZ2VMb2NrSnNvbiA9ICdwYWNrYWdlLWxvY2suanNvbic7XG5cbnBhdGhzLnJlZ2VuVGFyZ2V0cyA9IFtcbiAgICBgJHtwYXRocy5jb25maWdzfS8qLmpzYFxuXTtcblxuY29uc3QgQ0xJX0JBTk5FUiA9IGAvKipcbiogISEhIERPIE5PVCBFRElUIFRISVMgRklMRSBESVJFQ1RMWSAhISFcbiogISBUaGlzIGZpbGUgaGFzIGJlZW4gZ2VuZXJhdGVkIGF1dG9tYXRpY2FsbHkuIFNlZSB0aGUgKi5iYWJlbC5qcyB2ZXJzaW9uIG9mXG4qICEgdGhpcyBmaWxlIHRvIG1ha2UgcGVybWFuZW50IG1vZGlmaWNhdGlvbnMgKGluIGNvbmZpZy8pXG4qL1xcblxcbmA7XG5cbmNvbnN0IHJlYWRGaWxlQXN5bmMgPSBwcm9taXNpZnkocmVhZEZpbGUpO1xuXG4vLyAqIENMRUFOVFlQRVNcblxuY29uc3QgY2xlYW5UeXBlcyA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB0YXJnZXRzID0gcGFyc2VHaXRJZ25vcmUoYXdhaXQgcmVhZEZpbGVBc3luYyhwYXRocy5mbG93VHlwZWRHaXRJZ25vcmUpKTtcblxuICAgIGxvZyhgRGVsZXRpb24gdGFyZ2V0cyBAICR7RkxPV19UWVBFU19ESVJ9LzogXCIke3RhcmdldHMuam9pbignXCIgXCInKX1cImApO1xuICAgIGRlbCh0YXJnZXRzLCB7IGN3ZDogRkxPV19UWVBFU19ESVIgfSk7XG59O1xuXG5jbGVhblR5cGVzLmRlc2NyaXB0aW9uID0gYFJlc2V0cyB0aGUgJHtGTE9XX1RZUEVTX0RJUn0gZGlyZWN0b3J5IHRvIGEgcHJpc3RpbmUgc3RhdGVgO1xuXG4vLyAqIFJFR0VORVJBVEVcblxuLy8gPyBJZiB5b3UgY2hhbmdlIHRoaXMgZnVuY3Rpb24sIHJ1biBgbnBtIHJ1biByZWdlbmVyYXRlYCB0d2ljZTogb25jZSB0b1xuLy8gPyBjb21waWxlIHRoaXMgbmV3IGZ1bmN0aW9uIGFuZCBvbmNlIGFnYWluIHRvIGNvbXBpbGUgaXRzZWxmIHdpdGggdGhlIG5ld2x5XG4vLyA/IGNvbXBpbGVkIGxvZ2ljLiBJZiB0aGVyZSBpcyBhbiBlcnJvciB0aGF0IHByZXZlbnRzIHJlZ2VuZXJhdGlvbiwgeW91IGNhblxuLy8gPyBydW4gYG5wbSBydW4gZ2VuZXJhdGVgIHRoZW4gYG5wbSBydW4gcmVnZW5lcmF0ZWAgaW5zdGVhZC5cbmNvbnN0IHJlZ2VuZXJhdGUgPSAoKSA9PiB7XG4gICAgbG9nKGBSZWdlbmVyYXRpbmcgdGFyZ2V0czogXCIke3BhdGhzLnJlZ2VuVGFyZ2V0cy5qb2luKCdcIiBcIicpfVwiYCk7XG5cbiAgICBwcm9jZXNzLmVudi5CQUJFTF9FTlYgPSAnZ2VuZXJhdG9yJztcblxuICAgIHJldHVybiBndWxwLnNyYyhwYXRocy5yZWdlblRhcmdldHMpXG4gICAgICAgICAgICAgICAucGlwZSh0YXAoZmlsZSA9PiBmaWxlLmNvbnRlbnRzID0gQnVmZmVyLmZyb20oQ0xJX0JBTk5FUiArIGJhYmVsKGZpbGUuY29udGVudHMudG9TdHJpbmcoKSwge1xuICAgICAgICAgICAgICAgICAgIHNvdXJjZUZpbGVOYW1lOiByZWxQYXRoKF9fZGlybmFtZSwgZmlsZS5wYXRoKVxuICAgICAgICAgICAgICAgfSkuY29kZSkpKVxuICAgICAgICAgICAgICAgLnBpcGUoZ3VscC5kZXN0KCcuJykpO1xufTtcblxucmVnZW5lcmF0ZS5kZXNjcmlwdGlvbiA9ICdJbnZva2VzIGJhYmVsIG9uIHRoZSBmaWxlcyBpbiBjb25maWcsIHRyYW5zcGlsaW5nIHRoZW0gaW50byB0aGVpciBwcm9qZWN0IHJvb3QgdmVyc2lvbnMnO1xuXG4vLyAqIEVKRUNUXG5cbmNvbnN0IGVqZWN0ID0gKCkgPT4gdGVybS5wcm9tcHQoW1xuICAgIHtcbiAgICAgICAgdHlwZTogJ2lucHV0JyxcbiAgICAgICAgbmFtZTogJ3BhY2thZ2UubmFtZScsXG4gICAgICAgIG1lc3NhZ2U6ICdbcGFja2FnZS5qc29uXSBTcGVjaWZ5IG5hbWUgZm9yIHRoaXMgcHJvamVjdCAobXVzdCBiZSB2YWxpZCBhcyBhIGRpcmVjdG9yeSBuYW1lKSdcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogJ2lucHV0JyxcbiAgICAgICAgbmFtZTogJ3BhY2thZ2UuZGVzYycsXG4gICAgICAgIG1lc3NhZ2U6ICdbcGFja2FnZS5qc29uXSBWZXJ5IGJyaWVmbHkgZGVzY3JpYmUgdGhpcyBwcm9qZWN0JyxcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogJ2lucHV0JyxcbiAgICAgICAgbmFtZTogJ3BhY2thZ2UucmVwby51cmwnLFxuICAgICAgICBtZXNzYWdlOiAnW3BhY2thZ2UuanNvbl0gU3BlY2lmeSBhIGdpdCByZXBvc2l0b3J5IFVSTCdcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogJ2lucHV0JyxcbiAgICAgICAgbmFtZTogJ2RlYnVnLmFkZHJlc3MnLFxuICAgICAgICBtZXNzYWdlOiAnW2xhdW5jaC5qc29uXSBTcGVjaWZ5IHlvdXIgZGV2L3JlbW90ZS9zZXJ2ZXIgaXAgYWRkcmVzcyAodGhlIG9uZSBydW5uaW5nIG5vZGUpJyxcbiAgICAgICAgZGVmYXVsdDogJzE5Mi4xNjguMTE1LjUnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgIG5hbWU6ICdkZWJ1Zy51cmwnLFxuICAgICAgICBtZXNzYWdlOiAnW2xhdW5jaC5qc29uXSBTcGVjaWZ5IHRoZSBVUkwgZW50cnkgcG9pbnQgZm9yIHlvdXIgYXBwbGljYXRpb24nLFxuICAgICAgICBkZWZhdWx0OiAnaHR0cDovL2Rldi5sb2NhbDo4MCdcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogJ2lucHV0JyxcbiAgICAgICAgbmFtZTogJ2RlYnVnLnJlbW90ZVJvb3QnLFxuICAgICAgICBtZXNzYWdlOiBcIltsYXVuY2guanNvbl0gU3BlY2lmeSBhbiAqYWJzb2x1dGUqIHBhdGggdG8gdGhpcyBwcm9qZWN0J3Mgcm9vdCBvbiByZW1vdGUvc2VydmVyXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogJ2NvbmZpcm0nLFxuICAgICAgICBuYW1lOiAnaW5zdGFsbFR5cGVzJyxcbiAgICAgICAgbWVzc2FnZTogJ0RvIHlvdSB3YW50IHRvIGluc3RhbGwgRmxvdyB0eXBlcyBmb3IgYWxsIGxvY2FsIHBhY2thZ2VzPycsXG4gICAgICAgIGRlZmF1bHQ6IHRydWVcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogJ2NvbmZpcm0nLFxuICAgICAgICBuYW1lOiAnY29uZmlybScsXG4gICAgICAgIG1lc3NhZ2U6ICdEb2VzIGV2ZXJ5dGhpbmcgbG9vayBnb29kPycsXG4gICAgICAgIGRlZmF1bHQ6IGZhbHNlXG4gICAgfVxuXSkudGhlbihhbnN3ZXJzID0+IHtcbiAgICBpZighYW5zd2Vycy5jb25maXJtKVxuICAgICAgICByZXR1cm4gbG9nLmVycm9yKCdUYXNrIGFib3J0ZWQhJyk7XG5cbiAgICB0cnkge1xuICAgICAgICBzaC5tdihwYXRocy5lbnZEaXN0LCBwYXRocy5lbnYpO1xuICAgICAgICBzaC5tdihwYXRocy5sYXVuY2hKc29uRGlzdCwgcGF0aHMubGF1bmNoSnNvbik7XG5cbiAgICAgICAgY29uc3QgZGVsdGExID0gcmVwbGFjZUluRmlsZSh7XG4gICAgICAgICAgICBmaWxlczogcGF0aHMucGFja2FnZUpzb24sXG4gICAgICAgICAgICBmcm9tOiBbLyhcIm5hbWVcIjogPylcIi4qP1wiL2csIC8oXCJkZXNjcmlwdGlvblwiOiA/KVwiLio/XCIvZywgLyhcInVybFwiOiA/KVwiLio/XCIvZ10sXG4gICAgICAgICAgICB0bzogW2AkMVwiJHthbnN3ZXJzLnBhY2thZ2UubmFtZX1cImAsIGAkMVwiJHthbnN3ZXJzLnBhY2thZ2UuZGVzY31cImAsIGAkMVwiJHthbnN3ZXJzLnBhY2thZ2UucmVwby51cmx9XCJgXSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgZGVsdGEyID0gcmVwbGFjZUluRmlsZSh7XG4gICAgICAgICAgICBmaWxlczogcGF0aHMubGF1bmNoSnNvbixcbiAgICAgICAgICAgIGZyb206IFsvKFwiYWRkcmVzc1wiOiA/KVwiLio/XCIvZywgLyhcInJlbW90ZVJvb3RcIjogPylcIi4qP1wiL2csIC8oXCJ1cmxcIjogPylcIi4qP1wiL2ddLFxuICAgICAgICAgICAgdG86IFtgJDFcIiR7YW5zd2Vycy5kZWJ1Zy5hZGRyZXNzfVwiYCwgYCQxXCIke2Fuc3dlcnMuZGVidWcucmVtb3RlUm9vdH1cImAsIGAkMVwiJHthbnN3ZXJzLmRlYnVnLnVybH1cImBdLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBkZWx0YTMgPSByZXBsYWNlSW5GaWxlKHtcbiAgICAgICAgICAgIGZpbGVzOiBwYXRocy5naXRJZ25vcmUsXG4gICAgICAgICAgICBmcm9tOiAncGFja2FnZS1sb2NrLmpzb24nLFxuICAgICAgICAgICAgdG86ICcnLFxuICAgICAgICB9KTtcblxuICAgICAgICBpZighZGVsdGExLmxlbmd0aClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlcmUgd2FzIGFuIGVycm9yIGF0dGVtcHRpbmcgdG8gYWNjZXNzIFwiJHtwYXRocy5wYWNrYWdlSnNvbn1cImApO1xuXG4gICAgICAgIGlmKCFkZWx0YTIubGVuZ3RoKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGVyZSB3YXMgYW4gZXJyb3IgYXR0ZW1wdGluZyB0byBhY2Nlc3MgXCIke3BhdGhzLmxhdW5jaEpzb259XCJgKTtcblxuICAgICAgICBpZighZGVsdGEzLmxlbmd0aClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlcmUgd2FzIGFuIGVycm9yIGF0dGVtcHRpbmcgdG8gYWNjZXNzIFwiJHtwYXRocy5naXRpZ25vcmV9XCJgKTtcblxuICAgICAgICBpZihhbnN3ZXJzLmluc3RhbGxUeXBlcylcbiAgICAgICAgICAgIHNoKCducG0gcnVuIGluc3RhbGwtdHlwZXMnKTtcblxuICAgICAgICBzaC5ybSgnLWYnLCBwYXRocy5wYWNrYWdlTG9ja0pzb24pO1xuICAgICAgICAvLyBzaC5ybSgnLWYnLCAnLmdpdCcpO1xuICAgICAgICBzaC5lY2hvKFwic2gucm0oJy1mJywgJy5naXQnKTtcIik7XG4gICAgICAgIC8vIHNoKCdnaXQgaW5pdCcpO1xuICAgICAgICBzaC5lY2hvKFwic2goJ2dpdCBpbml0Jyk7XCIpO1xuXG4gICAgICAgIHNoKGBjZCAuLiAmJiBtdiAnJHtwYXJzZVBhdGgoX19kaXJuYW1lKS5uYW1lfScgJyR7YW5zd2Vycy5wYWNrYWdlLm5hbWV9J2ApO1xuXG4gICAgICAgIGxvZy5pbmZvKCdCb2lsZXJwbGF0ZSBlamVjdGlvbiBjb21wbGV0ZSEnKTtcbiAgICAgICAgbG9nKGBOZXh0IHN0ZXBzOlxcblxcdC0gSWYgeW91J3JlIGdvaW5nIHRvIGhvc3QgdGhpcyBwcm9qZWN0IG9uIEdpdGh1Yi9HaXRsYWIsIGJlZ2luIHRoYXQgcHJvY2VzcyBub3dcXG5cXHQtIENoZWNrIG92ZXIgcGFja2FnZS5qc29uIGZvciBhY2N1cmFjeTsgcmVtb3ZlIGFueSB1bm5lY2Vzc2FyeSBkZXBlbmRlbmNpZXMvZGV2RGVwZW5kZW5jaWVzXFxuXFx0LSBMb29rIG92ZXIgLmVudiBhbmQgY29uZmlndXJlIGl0IHRvIHlvdXIgbGlraW5nXFxuYCk7XG4gICAgfVxuXG4gICAgY2F0Y2goZXJyKSB7XG4gICAgICAgIGxvZy5lcnJvcihgRVJST1I6ICR7ZXJyLnRvU3RyaW5nKCl9YCk7XG4gICAgfVxufSk7XG5cbmVqZWN0LmRlc2NyaXB0aW9uID0gJ0Fzc2lzdHMgaW4gY29uZmlndXJpbmcgdGhlIGJvaWxlcnBsYXRlIHRvIGJlIHNvbWV0aGluZyB1c2VmdWwnO1xuXG5leHBvcnQgeyBlamVjdCwgcmVnZW5lcmF0ZSwgY2xlYW5UeXBlcyB9O1xuIl19