/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the *.babel.js version of
* ! this file to make permanent modifications (in config/)
*/

"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.cleanTypes = exports.regenerate = exports.eject = void 0;

require("source-map-support/register");

var _fs = require("fs");

var _util = require("util");

var _gulp = _interopRequireDefault(require("gulp"));

var _gulpTap = _interopRequireDefault(require("gulp-tap"));

var _del = _interopRequireDefault(require("del"));

var _fancyLog = _interopRequireDefault(require("fancy-log"));

var _parseGitignore = _interopRequireDefault(require("parse-gitignore"));

var _core = require("@babel/core");

var _child_process = require("child_process");

var _path = require("path");

var _inquirer = _interopRequireDefault(require("inquirer"));

var _replaceInFile = _interopRequireDefault(require("replace-in-file"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const paths = {};
const FLOW_TYPES_DIR = 'flow-typed';
paths.flowTypedGitIgnore = `${FLOW_TYPES_DIR}/.gitignore`;
paths.configs = 'config';
paths.packageJson = 'package.json';
paths.launchJson = '.vscode/launch.json';
paths.launchJsonDist = '.vscode/launch.dist.json';
paths.env = '.env';
paths.envDist = 'dist.env';
paths.gitProjectDir = '.git';
paths.gitIgnore = '.gitignore';
paths.regenTargets = [`${paths.configs}/*.js`];
const CLI_BANNER = `/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the *.babel.js version of
* ! this file to make permanent modifications (in config/)
*/\n\n`;
const readFileAsync = (0, _util.promisify)(_fs.readFile);

const cleanTypes = async () => {
  const targets = (0, _parseGitignore.default)((await readFileAsync(paths.flowTypedGitIgnore)));
  (0, _fancyLog.default)(`Deletion targets @ ${FLOW_TYPES_DIR}/: "${targets.join('" "')}"`);
  (0, _del.default)(targets, {
    cwd: FLOW_TYPES_DIR
  });
};

exports.cleanTypes = cleanTypes;
cleanTypes.description = `Resets the ${FLOW_TYPES_DIR} directory to a pristine state`;

const regenerate = () => {
  (0, _fancyLog.default)(`Regenerating targets: "${paths.regenTargets.join('" "')}"`);
  process.env.BABEL_ENV = 'generator';
  return _gulp.default.src(paths.regenTargets).pipe((0, _gulpTap.default)(file => file.contents = Buffer.from(CLI_BANNER + (0, _core.transformSync)(file.contents.toString()).code))).pipe(_gulp.default.dest('.'));
};

exports.regenerate = regenerate;
regenerate.description = 'Invokes babel on the files in config, transpiling them into their project root versions';

const eject = () => _inquirer.default.prompt([{
  type: 'input',
  name: 'package.name',
  message: '[package.json] Specify name for this project (must be valid as a directory name)'
}, {
  type: 'input',
  name: 'package.desc',
  message: '[package.json] Very briefly describe this project'
}, {
  type: 'input',
  name: 'package.repo.url',
  message: '[package.json] Specify a git repository URL'
}, {
  type: 'input',
  name: 'debug.address',
  message: '[launch.json] Specify your dev/remote/server ip address (the one running node)',
  default: '192.168.115.5'
}, {
  type: 'input',
  name: 'debug.url',
  message: '[launch.json] Specify the URL entry point for your application',
  default: 'http://dev.local:80'
}, {
  type: 'input',
  name: 'debug.remoteRoot',
  message: "[launch.json] Specify an *absolute* path to this project's root on remote/server"
}, {
  type: 'confirm',
  name: 'installTypes',
  message: 'Do you want to install Flow types for all local packages?',
  default: true
}, {
  type: 'confirm',
  name: 'confirm',
  message: 'Does everything look good?',
  default: false
}]).then(async answers => {
  if (!answers.confirm) return _fancyLog.default.error('Task aborted!');

  try {
    const delta1 = (0, _replaceInFile.default)({
      files: paths.packageJson,
      from: [/("name": ?)".*?"/g, /"(description": ?)".*?"/g, /("url": ?)".*?"/g],
      to: [`$1"${answers.package.name}"`, `$1"${answers.package.desc}"`, `$1"${answers.package.repo.url}"`]
    });
    const delta2 = (0, _replaceInFile.default)({
      files: paths.launchJson,
      from: [/("address": ?)".*?"/g, /("remoteRoot": ?)".*?"/g, /("url": ?)".*?"/g],
      to: [`$1"${answers.debug.address}"`, `$1"${answers.debug.remoteRoot}"`, `$1"${answers.debug.url}"`]
    });
    const delta3 = (0, _replaceInFile.default)({
      files: paths.gitIgnore,
      from: 'package-lock.json',
      to: ''
    });
    if (!delta1.length) throw new Error(`There was an error attempting to access "${paths.packageJson}"`);
    if (!delta2.length) throw new Error(`There was an error attempting to access "${paths.launchJson}"`);
    if (!delta3.length) throw new Error(`There was an error attempting to access "${paths.gitignore}"`);
    if (answers.installTypes) await (0, _child_process.execAsync)('npm run install-types').stderr.pipe(process.stderr);
    await (0, _child_process.execAsync)('rm -f .git').stderr.pipe(process.stderr);
    await (0, _child_process.execAsync)(`git init`).stderr.pipe(process.stderr);
    await (0, _child_process.execAsync)(`mv ${paths.envDist} ${paths.env}`).stderr.pipe(process.stderr);
    await (0, _child_process.execAsync)(`mv ${paths.launchJsonDist} ${paths.launchJson}`).stderr.pipe(process.stderr);
    const dir = (0, _path.parse)(__dirname);
    await (0, _child_process.execAsync)(`cd .. && mv ${dir.name} ${answers.package.name}`).stderr.pipe(process.stderr);

    _fancyLog.default.info('Boilerplate ejection complete!');

    (0, _fancyLog.default)(`Next steps:\n\t- If you're going to host this project on Github/Gitlab, begin that process now\n\t- Check over package.json for accuracy; remove any unnecessary dependencies/devDependencies\n\t- Look over .env and configure it to your liking\n`);
  } catch (err) {
    _fancyLog.default.error(`ERROR: ${err.toString()}`);
  }
});

exports.eject = eject;
eject.description = 'Assists in configuring the boilerplate to be something useful';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVua25vd24iXSwibmFtZXMiOlsicGF0aHMiLCJGTE9XX1RZUEVTX0RJUiIsImZsb3dUeXBlZEdpdElnbm9yZSIsImNvbmZpZ3MiLCJwYWNrYWdlSnNvbiIsImxhdW5jaEpzb24iLCJsYXVuY2hKc29uRGlzdCIsImVudiIsImVudkRpc3QiLCJnaXRQcm9qZWN0RGlyIiwiZ2l0SWdub3JlIiwicmVnZW5UYXJnZXRzIiwiQ0xJX0JBTk5FUiIsInJlYWRGaWxlQXN5bmMiLCJyZWFkRmlsZSIsImNsZWFuVHlwZXMiLCJ0YXJnZXRzIiwiam9pbiIsImN3ZCIsImRlc2NyaXB0aW9uIiwicmVnZW5lcmF0ZSIsInByb2Nlc3MiLCJCQUJFTF9FTlYiLCJndWxwIiwic3JjIiwicGlwZSIsImZpbGUiLCJjb250ZW50cyIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsImNvZGUiLCJkZXN0IiwiZWplY3QiLCJ0ZXJtIiwicHJvbXB0IiwidHlwZSIsIm5hbWUiLCJtZXNzYWdlIiwiZGVmYXVsdCIsInRoZW4iLCJhbnN3ZXJzIiwiY29uZmlybSIsImxvZyIsImVycm9yIiwiZGVsdGExIiwiZmlsZXMiLCJ0byIsInBhY2thZ2UiLCJkZXNjIiwicmVwbyIsInVybCIsImRlbHRhMiIsImRlYnVnIiwiYWRkcmVzcyIsInJlbW90ZVJvb3QiLCJkZWx0YTMiLCJsZW5ndGgiLCJFcnJvciIsImdpdGlnbm9yZSIsImluc3RhbGxUeXBlcyIsInN0ZGVyciIsImRpciIsIl9fZGlybmFtZSIsImluZm8iLCJlcnIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQVNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsTUFBTUEsS0FBSyxHQUFHLEVBQWQ7QUFDQSxNQUFNQyxjQUFjLEdBQUcsWUFBdkI7QUFFQUQsS0FBSyxDQUFDRSxrQkFBTixHQUE0QixHQUFFRCxjQUFlLGFBQTdDO0FBQ0FELEtBQUssQ0FB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QWxFLENBQU47QUFDQSxVQUFNLDhCQUFXLE1BQUs3RCxLQUFLLENBQUNNLGNBQWUsSUFBR04sS0FBSyxDQUFDSyxVQUFXLEVBQXpELEVBQTREd0QsTUFBNUQsQ0FBbUVwQyxJQUFuRSxDQUF3RUosT0FBTyxDQUFDd0MsTUFBaEYsQ0FBTjtBQUVBLFVBQU1DLEdBQUcsR0FBRyxpQkFBVUMsU0FBVixDQUFaO0FBRUEsVUFBTSw4QkFBVyxlQUFjRCxHQUFHLENBQUN6QixJQUFLLElBQUdJLE9BQU8sQ0FBQ08sT0FBUixDQUFnQlgsSUFBSyxFQUExRCxFQUE2RHdCLE1BQTdELENBQW9FcEMsSUFBcEUsQ0FBeUVKLE9BQU8sQ0FBQ3dDLE1BQWpGLENBQU47O0FBRUFsQixzQkFBSXFCLElBQUosQ0FBUyxnQ0FBVDs7QUFDQSwyQkFBSyxxUEFBTDtBQUNILEdBMUNELENBNENBLE9BQU1DLEdBQU4sRUFBVztBQUNQdEIsc0JBQUlDLEtBQUosQ0FBVyxVQUFTcUIsR0FBRyxDQUFDbkMsUUFBSixFQUFlLEVBQW5DO0FBQ0g7QUFDSixDQWhHbUIsQ0FBcEI7OztBQWtHQUcsS0FBSyxDQUFDZCxXQUFOLEdBQW9CLCtEQUFwQiIsInNvdXJjZXNDb250ZW50IjpbIi8qIEBmbG93ICovXG5cbi8vID8gVG8gcmVnZW5lcmF0ZSB0aGlzIGZpbGUgKGkuZS4gaWYgeW91IGNoYW5nZWQgaXQgYW5kIHdhbnQgeW91ciBjaGFuZ2VzIHRvXG4vLyA/IGJlIHBlcm1hbmVudCksIGNhbGwgYG5wbSBydW4gcmVnZW5lcmF0ZWAgYWZ0ZXJ3YXJkc1xuXG4vLyAhIEJlIHN1cmUgdGhhdCB0YXNrcyBleHBlY3RlZCB0byBydW4gb24gbnBtIGluc3RhbGwgKG1hcmtlZCBAZGVwZW5kZW50KSBoYXZlXG4vLyAhIGFsbCByZXF1aXJlZCBwYWNrYWdlcyBsaXN0ZWQgdW5kZXIgXCJkZXBlbmRlbmNpZXNcIiBpbnN0ZWFkIG9mXG4vLyAhIFwiZGV2RGVwZW5kZW5jaWVzXCIgaW4gdGhpcyBwcm9qZWN0J3MgcGFja2FnZS5qc29uXG5cbmltcG9ydCB7IHJlYWRGaWxlIH0gZnJvbSAnZnMnXG5pbXBvcnQgeyBwcm9taXNpZnkgfSBmcm9tICd1dGlsJ1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCdcbmltcG9ydCB0YXAgZnJvbSAnZ3VscC10YXAnXG5pbXBvcnQgZGVsIGZyb20gJ2RlbCdcbmltcG9ydCBsb2cgZnJvbSAnZmFuY3ktbG9nJ1xuaW1wb3J0IHBhcnNlR2l0SWdub3JlIGZyb20gJ3BhcnNlLWdpdGlnbm9yZSdcbmltcG9ydCB7IHRyYW5zZm9ybVN5bmMgYXMgYmFiZWwgfSBmcm9tICdAYmFiZWwvY29yZSdcbmltcG9ydCB7IGV4ZWNBc3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnXG5pbXBvcnQgeyBwYXJzZSBhcyBwYXJzZVBhdGggfSBmcm9tICdwYXRoJ1xuaW1wb3J0IHRlcm0gZnJvbSAnaW5xdWlyZXInXG5pbXBvcnQgcmVwbGFjZUluRmlsZSBmcm9tICdyZXBsYWNlLWluLWZpbGUnXG5cbmNvbnN0IHBhdGhzID0ge307XG5jb25zdCBGTE9XX1RZUEVTX0RJUiA9ICdmbG93LXR5cGVkJztcblxucGF0aHMuZmxvd1R5cGVkR2l0SWdub3JlID0gYCR7RkxPV19UWVBFU19ESVJ9Ly5naXRpZ25vcmVgO1xucGF0aHMuY29uZmlncyA9ICdjb25maWcnO1xucGF0aHMucGFja2FnZUpzb24gPSAncGFja2FnZS5qc29uJztcbnBhdGhzLmxhdW5jaEpzb24gPSAnLnZzY29kZS9sYXVuY2guanNvbic7XG5wYXRocy5sYXVuY2hKc29uRGlzdCA9ICcudnNjb2RlL2xhdW5jaC5kaXN0Lmpzb24nO1xucGF0aHMuZW52ID0gJy5lbnYnO1xucGF0aHMuZW52RGlzdCA9ICdkaXN0LmVudic7XG5wYXRocy5naXRQcm9qZWN0RGlyID0gJy5naXQnO1xucGF0aHMuZ2l0SWdub3JlID0gJy5naXRpZ25vcmUnO1xuXG5wYXRocy5yZWdlblRhcmdldHMgPSBbXG4gICAgYCR7cGF0aHMuY29uZmlnc30vKi5qc2Bcbl07XG5cbmNvbnN0IENMSV9CQU5ORVIgPSBgLyoqXG4qICEhISBETyBOT1QgRURJVCBUSElTIEZJTEUgRElSRUNUTFkgISEhXG4qICEgVGhpcyBmaWxlIGhhcyBiZWVuIGdlbmVyYXRlZCBhdXRvbWF0aWNhbGx5LiBTZWUgdGhlICouYmFiZWwuanMgdmVyc2lvbiBvZlxuKiAhIHRoaXMgZmlsZSB0byBtYWtlIHBlcm1hbmVudCBtb2RpZmljYXRpb25zIChpbiBjb25maWcvKVxuKi9cXG5cXG5gO1xuXG5jb25zdCByZWFkRmlsZUFzeW5jID0gcHJvbWlzaWZ5KHJlYWRGaWxlKTtcblxuLy8gKiBDTEVBTlRZUEVTXG5cbmNvbnN0IGNsZWFuVHlwZXMgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0cyA9IHBhcnNlR2l0SWdub3JlKGF3YWl0IHJlYWRGaWxlQXN5bmMocGF0aHMuZmxvd1R5cGVkR2l0SWdub3JlKSk7XG5cbiAgICBsb2coYERlbGV0aW9uIHRhcmdldHMgQCAke0ZMT1dfVFlQRVNfRElSfS86IFwiJHt0YXJnZXRzLmpvaW4oJ1wiIFwiJyl9XCJgKTtcbiAgICBkZWwodGFyZ2V0cywgeyBjd2Q6IEZMT1dfVFlQRVNfRElSIH0pO1xufTtcblxuY2xlYW5UeXBlcy5kZXNjcmlwdGlvbiA9IGBSZXNldHMgdGhlICR7RkxPV19UWVBFU19ESVJ9IGRpcmVjdG9yeSB0byBhIHByaXN0aW5lIHN0YXRlYDtcblxuLy8gKiBSRUdFTkVSQVRFXG5cbi8vID8gSWYgeW91IGNoYW5nZSB0aGlzIGZ1bmN0aW9uLCBydW4gYG5wbSBydW4gcmVnZW5lcmF0ZWAgdHdpY2U6IG9uY2UgdG9cbi8vID8gY29tcGlsZSB0aGlzIG5ldyBmdW5jdGlvbiBhbmQgb25jZSBhZ2FpbiB0byBjb21waWxlIGl0c2VsZiB3aXRoIHRoZSBuZXdseVxuLy8gPyBjb21waWxlZCBsb2dpYy4gSWYgdGhlcmUgaXMgYW4gZXJyb3IgdGhhdCBwcmV2ZW50cyByZWdlbmVyYXRpb24sIHlvdSBjYW5cbi8vID8gcnVuIGBucG0gcnVuIHJlZ2VuZXJhdGVgIGJlZm9yZSBgbnBtIHJ1biByZWdlbmVyYXRlYCBpbnN0ZWFkLlxuY29uc3QgcmVnZW5lcmF0ZSA9ICgpID0+IHtcbiAgICBsb2coYFJlZ2VuZXJhdGluZyB0YXJnZXRzOiBcIiR7cGF0aHMucmVnZW5UYXJnZXRzLmpvaW4oJ1wiIFwiJyl9XCJgKTtcblxuICAgIHByb2Nlc3MuZW52LkJBQkVMX0VOViA9ICdnZW5lcmF0b3InO1xuXG4gICAgcmV0dXJuIGd1bHAuc3JjKHBhdGhzLnJlZ2VuVGFyZ2V0cylcbiAgICAgICAgICAgICAgIC5waXBlKHRhcChmaWxlID0+IGZpbGUuY29udGVudHMgPSBCdWZmZXIuZnJvbShDTElfQkFOTkVSICsgYmFiZWwoZmlsZS5jb250ZW50cy50b1N0cmluZygpKS5jb2RlKSkpXG4gICAgICAgICAgICAgICAucGlwZShndWxwLmRlc3QoJy4nKSk7XG59O1xuXG5yZWdlbmVyYXRlLmRlc2NyaXB0aW9uID0gJ0ludm9rZXMgYmFiZWwgb24gdGhlIGZpbGVzIGluIGNvbmZpZywgdHJhbnNwaWxpbmcgdGhlbSBpbnRvIHRoZWlyIHByb2plY3Qgcm9vdCB2ZXJzaW9ucyc7XG5cbi8vICogRUpFQ1RcblxuY29uc3QgZWplY3QgPSAoKSA9PiB0ZXJtLnByb21wdChbXG4gICAge1xuICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICBuYW1lOiAncGFja2FnZS5uYW1lJyxcbiAgICAgICAgbWVzc2FnZTogJ1twYWNrYWdlLmpzb25dIFNwZWNpZnkgbmFtZSBmb3IgdGhpcyBwcm9qZWN0IChtdXN0IGJlIHZhbGlkIGFzIGEgZGlyZWN0b3J5IG5hbWUpJ1xuICAgIH0sXG4gICAge1xuICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICBuYW1lOiAncGFja2FnZS5kZXNjJyxcbiAgICAgICAgbWVzc2FnZTogJ1twYWNrYWdlLmpzb25dIFZlcnkgYnJpZWZseSBkZXNjcmliZSB0aGlzIHByb2plY3QnLFxuICAgIH0sXG4gICAge1xuICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICBuYW1lOiAncGFja2FnZS5yZXBvLnVybCcsXG4gICAgICAgIG1lc3NhZ2U6ICdbcGFja2FnZS5qc29uXSBTcGVjaWZ5IGEgZ2l0IHJlcG9zaXRvcnkgVVJMJ1xuICAgIH0sXG4gICAge1xuICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICBuYW1lOiAnZGVidWcuYWRkcmVzcycsXG4gICAgICAgIG1lc3NhZ2U6ICdbbGF1bmNoLmpzb25dIFNwZWNpZnkgeW91ciBkZXYvcmVtb3RlL3NlcnZlciBpcCBhZGRyZXNzICh0aGUgb25lIHJ1bm5pbmcgbm9kZSknLFxuICAgICAgICBkZWZhdWx0OiAnMTkyLjE2OC4xMTUuNSdcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogJ2lucHV0JyxcbiAgICAgICAgbmFtZTogJ2RlYnVnLnVybCcsXG4gICAgICAgIG1lc3NhZ2U6ICdbbGF1bmNoLmpzb25dIFNwZWNpZnkgdGhlIFVSTCBlbnRyeSBwb2ludCBmb3IgeW91ciBhcHBsaWNhdGlvbicsXG4gICAgICAgIGRlZmF1bHQ6ICdodHRwOi8vZGV2LmxvY2FsOjgwJ1xuICAgIH0sXG4gICAge1xuICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICBuYW1lOiAnZGVidWcucmVtb3RlUm9vdCcsXG4gICAgICAgIG1lc3NhZ2U6IFwiW2xhdW5jaC5qc29uXSBTcGVjaWZ5IGFuICphYnNvbHV0ZSogcGF0aCB0byB0aGlzIHByb2plY3QncyByb290IG9uIHJlbW90ZS9zZXJ2ZXJcIlxuICAgIH0sXG4gICAge1xuICAgICAgICB0eXBlOiAnY29uZmlybScsXG4gICAgICAgIG5hbWU6ICdpbnN0YWxsVHlwZXMnLFxuICAgICAgICBtZXNzYWdlOiAnRG8geW91IHdhbnQgdG8gaW5zdGFsbCBGbG93IHR5cGVzIGZvciBhbGwgbG9jYWwgcGFja2FnZXM/JyxcbiAgICAgICAgZGVmYXVsdDogdHJ1ZVxuICAgIH0sXG4gICAge1xuICAgICAgICB0eXBlOiAnY29uZmlybScsXG4gICAgICAgIG5hbWU6ICdjb25maXJtJyxcbiAgICAgICAgbWVzc2FnZTogJ0RvZXMgZXZlcnl0aGluZyBsb29rIGdvb2Q/JyxcbiAgICAgICAgZGVmYXVsdDogZmFsc2VcbiAgICB9XG5dKS50aGVuKGFzeW5jIGFuc3dlcnMgPT4ge1xuICAgIGlmKCFhbnN3ZXJzLmNvbmZpcm0pXG4gICAgICAgIHJldHVybiBsb2cuZXJyb3IoJ1Rhc2sgYWJvcnRlZCEnKTtcblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRlbHRhMSA9IHJlcGxhY2VJbkZpbGUoe1xuICAgICAgICAgICAgZmlsZXM6IHBhdGhzLnBhY2thZ2VKc29uLFxuICAgICAgICAgICAgZnJvbTogWy8oXCJuYW1lXCI6ID8pXCIuKj9cIi9nLCAvXCIoZGVzY3JpcHRpb25cIjogPylcIi4qP1wiL2csIC8oXCJ1cmxcIjogPylcIi4qP1wiL2ddLFxuICAgICAgICAgICAgdG86IFtgJDFcIiR7YW5zd2Vycy5wYWNrYWdlLm5hbWV9XCJgLCBgJDFcIiR7YW5zd2Vycy5wYWNrYWdlLmRlc2N9XCJgLCBgJDFcIiR7YW5zd2Vycy5wYWNrYWdlLnJlcG8udXJsfVwiYF0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGRlbHRhMiA9IHJlcGxhY2VJbkZpbGUoe1xuICAgICAgICAgICAgZmlsZXM6IHBhdGhzLmxhdW5jaEpzb24sXG4gICAgICAgICAgICBmcm9tOiBbLyhcImFkZHJlc3NcIjogPylcIi4qP1wiL2csIC8oXCJyZW1vdGVSb290XCI6ID8pXCIuKj9cIi9nLCAvKFwidXJsXCI6ID8pXCIuKj9cIi9nXSxcbiAgICAgICAgICAgIHRvOiBbYCQxXCIke2Fuc3dlcnMuZGVidWcuYWRkcmVzc31cImAsIGAkMVwiJHthbnN3ZXJzLmRlYnVnLnJlbW90ZVJvb3R9XCJgLCBgJDFcIiR7YW5zd2Vycy5kZWJ1Zy51cmx9XCJgXSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgZGVsdGEzID0gcmVwbGFjZUluRmlsZSh7XG4gICAgICAgICAgICBmaWxlczogcGF0aHMuZ2l0SWdub3JlLFxuICAgICAgICAgICAgZnJvbTogJ3BhY2thZ2UtbG9jay5qc29uJyxcbiAgICAgICAgICAgIHRvOiAnJyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYoIWRlbHRhMS5sZW5ndGgpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIHdhcyBhbiBlcnJvciBhdHRlbXB0aW5nIHRvIGFjY2VzcyBcIiR7cGF0aHMucGFja2FnZUpzb259XCJgKTtcblxuICAgICAgICBpZighZGVsdGEyLmxlbmd0aClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlcmUgd2FzIGFuIGVycm9yIGF0dGVtcHRpbmcgdG8gYWNjZXNzIFwiJHtwYXRocy5sYXVuY2hKc29ufVwiYCk7XG5cbiAgICAgICAgaWYoIWRlbHRhMy5sZW5ndGgpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIHdhcyBhbiBlcnJvciBhdHRlbXB0aW5nIHRvIGFjY2VzcyBcIiR7cGF0aHMuZ2l0aWdub3JlfVwiYCk7XG5cbiAgICAgICAgaWYoYW5zd2Vycy5pbnN0YWxsVHlwZXMpXG4gICAgICAgICAgICBhd2FpdCBleGVjQXN5bmMoJ25wbSBydW4gaW5zdGFsbC10eXBlcycpLnN0ZGVyci5waXBlKHByb2Nlc3Muc3RkZXJyKTtcblxuICAgICAgICBhd2FpdCBleGVjQXN5bmMoJ3JtIC1mIC5naXQnKS5zdGRlcnIucGlwZShwcm9jZXNzLnN0ZGVycik7XG4gICAgICAgIGF3YWl0IGV4ZWNBc3luYyhgZ2l0IGluaXRgKS5zdGRlcnIucGlwZShwcm9jZXNzLnN0ZGVycik7XG4gICAgICAgIGF3YWl0IGV4ZWNBc3luYyhgbXYgJHtwYXRocy5lbnZEaXN0fSAke3BhdGhzLmVudn1gKS5zdGRlcnIucGlwZShwcm9jZXNzLnN0ZGVycik7XG4gICAgICAgIGF3YWl0IGV4ZWNBc3luYyhgbXYgJHtwYXRocy5sYXVuY2hKc29uRGlzdH0gJHtwYXRocy5sYXVuY2hKc29ufWApLnN0ZGVyci5waXBlKHByb2Nlc3Muc3RkZXJyKTtcblxuICAgICAgICBjb25zdCBkaXIgPSBwYXJzZVBhdGgoX19kaXJuYW1lKTtcblxuICAgICAgICBhd2FpdCBleGVjQXN5bmMoYGNkIC4uICYmIG12ICR7ZGlyLm5hbWV9ICR7YW5zd2Vycy5wYWNrYWdlLm5hbWV9YCkuc3RkZXJyLnBpcGUocHJvY2Vzcy5zdGRlcnIpO1xuXG4gICAgICAgIGxvZy5pbmZvKCdCb2lsZXJwbGF0ZSBlamVjdGlvbiBjb21wbGV0ZSEnKTtcbiAgICAgICAgbG9nKGBOZXh0IHN0ZXBzOlxcblxcdC0gSWYgeW91J3JlIGdvaW5nIHRvIGhvc3QgdGhpcyBwcm9qZWN0IG9uIEdpdGh1Yi9HaXRsYWIsIGJlZ2luIHRoYXQgcHJvY2VzcyBub3dcXG5cXHQtIENoZWNrIG92ZXIgcGFja2FnZS5qc29uIGZvciBhY2N1cmFjeTsgcmVtb3ZlIGFueSB1bm5lY2Vzc2FyeSBkZXBlbmRlbmNpZXMvZGV2RGVwZW5kZW5jaWVzXFxuXFx0LSBMb29rIG92ZXIgLmVudiBhbmQgY29uZmlndXJlIGl0IHRvIHlvdXIgbGlraW5nXFxuYCk7XG4gICAgfVxuXG4gICAgY2F0Y2goZXJyKSB7XG4gICAgICAgIGxvZy5lcnJvcihgRVJST1I6ICR7ZXJyLnRvU3RyaW5nKCl9YCk7XG4gICAgfVxufSk7XG5cbmVqZWN0LmRlc2NyaXB0aW9uID0gJ0Fzc2lzdHMgaW4gY29uZmlndXJpbmcgdGhlIGJvaWxlcnBsYXRlIHRvIGJlIHNvbWV0aGluZyB1c2VmdWwnO1xuXG5leHBvcnQgeyBlamVjdCwgcmVnZW5lcmF0ZSwgY2xlYW5UeXBlcyB9O1xuIl19