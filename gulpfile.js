/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the *.babel.js version of
* ! this file to make permanent modifications (in config/)
*/

"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.cleanTypes = exports.regenerate = exports.eject = void 0;

require("source-map-support/register");

var _fs = require("fs");

var _util = require("util");

var _gulp = _interopRequireDefault(require("gulp"));

var _gulpTap = _interopRequireDefault(require("gulp-tap"));

var _del = _interopRequireDefault(require("del"));

var _fancyLog = _interopRequireDefault(require("fancy-log"));

var _parseGitignore = _interopRequireDefault(require("parse-gitignore"));

var _core = require("@babel/core");

var _child_process = require("child_process");

var _path = require("path");

var _inquirer = _interopRequireDefault(require("inquirer"));

var _replaceInFile = _interopRequireDefault(require("replace-in-file"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const paths = {};
const FLOW_TYPES_DIR = 'flow-typed';
paths.flowTypedGitIgnore = `${FLOW_TYPES_DIR}/.gitignore`;
paths.configs = 'config';
paths.packageJson = 'package.json';
paths.launchJson = '.vscode/launch.json';
paths.launchJsonDist = '.vscode/launch.dist.json';
paths.env = '.env';
paths.envDist = 'dist.env';
paths.gitProjectDir = '.git';
paths.gitIgnore = '.gitignore';
paths.packageLockJson = 'package-lock.json';
paths.regenTargets = [`${paths.configs}/*.js`];
const CLI_BANNER = `/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the *.babel.js version of
* ! this file to make permanent modifications (in config/)
*/\n\n`;
const readFileAsync = (0, _util.promisify)(_fs.readFile);

const cleanTypes = async () => {
  const targets = (0, _parseGitignore.default)((await readFileAsync(paths.flowTypedGitIgnore)));
  (0, _fancyLog.default)(`Deletion targets @ ${FLOW_TYPES_DIR}/: "${targets.join('" "')}"`);
  (0, _del.default)(targets, {
    cwd: FLOW_TYPES_DIR
  });
};

exports.cleanTypes = cleanTypes;
cleanTypes.description = `Resets the ${FLOW_TYPES_DIR} directory to a pristine state`;

const regenerate = () => {
  (0, _fancyLog.default)(`Regenerating targets: "${paths.regenTargets.join('" "')}"`);
  process.env.BABEL_ENV = 'generator';
  return _gulp.default.src(paths.regenTargets).pipe((0, _gulpTap.default)(file => file.contents = Buffer.from(CLI_BANNER + (0, _core.transformSync)(file.contents.toString()).code))).pipe(_gulp.default.dest('.'));
};

exports.regenerate = regenerate;
regenerate.description = 'Invokes babel on the files in config, transpiling them into their project root versions';

const eject = () => _inquirer.default.prompt([{
  type: 'input',
  name: 'package.name',
  message: '[package.json] Specify name for this project (must be valid as a directory name)'
}, {
  type: 'input',
  name: 'package.desc',
  message: '[package.json] Very briefly describe this project'
}, {
  type: 'input',
  name: 'package.repo.url',
  message: '[package.json] Specify a git repository URL'
}, {
  type: 'input',
  name: 'debug.address',
  message: '[launch.json] Specify your dev/remote/server ip address (the one running node)',
  default: '192.168.115.5'
}, {
  type: 'input',
  name: 'debug.url',
  message: '[launch.json] Specify the URL entry point for your application',
  default: 'http://dev.local:80'
}, {
  type: 'input',
  name: 'debug.remoteRoot',
  message: "[launch.json] Specify an *absolute* path to this project's root on remote/server"
}, {
  type: 'confirm',
  name: 'installTypes',
  message: 'Do you want to install Flow types for all local packages?',
  default: true
}, {
  type: 'confirm',
  name: 'confirm',
  message: 'Does everything look good?',
  default: false
}]).then(async answers => {
  if (!answers.confirm) return _fancyLog.default.error('Task aborted!');

  try {
    await (0, _child_process.execAsync)(`mv ${paths.envDist} ${paths.env}`).stderr.pipe(process.stderr);
    await (0, _child_process.execAsync)(`mv ${paths.launchJsonDist} ${paths.launchJson}`).stderr.pipe(process.stderr);
    const delta1 = (0, _replaceInFile.default)({
      files: paths.packageJson,
      from: [/("name": ?)".*?"/g, /"(description": ?)".*?"/g, /("url": ?)".*?"/g],
      to: [`$1"${answers.package.name}"`, `$1"${answers.package.desc}"`, `$1"${answers.package.repo.url}"`]
    });
    const delta2 = (0, _replaceInFile.default)({
      files: paths.launchJson,
      from: [/("address": ?)".*?"/g, /("remoteRoot": ?)".*?"/g, /("url": ?)".*?"/g],
      to: [`$1"${answers.debug.address}"`, `$1"${answers.debug.remoteRoot}"`, `$1"${answers.debug.url}"`]
    });
    const delta3 = (0, _replaceInFile.default)({
      files: paths.gitIgnore,
      from: 'package-lock.json',
      to: ''
    });
    if (!delta1.length) throw new Error(`There was an error attempting to access "${paths.packageJson}"`);
    if (!delta2.length) throw new Error(`There was an error attempting to access "${paths.launchJson}"`);
    if (!delta3.length) throw new Error(`There was an error attempting to access "${paths.gitignore}"`);
    if (answers.installTypes) await (0, _child_process.execAsync)('npm run install-types').stderr.pipe(process.stderr);
    await (0, _child_process.execAsync)(`rm -f ${paths.packageLockJson}`).stderr.pipe(process.stderr);
    await (0, _child_process.execAsync)('echo "rm -f .git"').stderr.pipe(process.stderr);
    await (0, _child_process.execAsync)(`echo "git init"`).stderr.pipe(process.stderr);
    await (0, _child_process.execAsync)(`cd .. && mv ${(0, _path.parse)(__dirname).name} ${answers.package.name}`).stderr.pipe(process.stderr);

    _fancyLog.default.info('Boilerplate ejection complete!');

    (0, _fancyLog.default)(`Next steps:\n\t- If you're going to host this project on Github/Gitlab, begin that process now\n\t- Check over package.json for accuracy; remove any unnecessary dependencies/devDependencies\n\t- Look over .env and configure it to your liking\n`);
  } catch (err) {
    _fancyLog.default.error(`ERROR: ${err.toString()}`);
  }
});

exports.eject = eject;
eject.description = 'Assists in configuring the boilerplate to be something useful';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVua25vd24iXSwibmFtZXMiOlsicGF0aHMiLCJGTE9XX1RZUEVTX0RJUiIsImZsb3dUeXBlZEdpdElnbm9yZSIsImNvbmZpZ3MiLCJwYWNrYWdlSnNvbiIsImxhdW5jaEpzb24iLCJsYXVuY2hKc29uRGlzdCIsImVudiIsImVudkRpc3QiLCJnaXRQcm9qZWN0RGlyIiwiZ2l0SWdub3JlIiwicGFja2FnZUxvY2tKc29uIiwicmVnZW5UYXJnZXRzIiwiQ0xJX0JBTk5FUiIsInJlYWRGaWxlQXN5bmMiLCJyZWFkRmlsZSIsImNsZWFuVHlwZXMiLCJ0YXJnZXRzIiwiam9pbiIsImN3ZCIsImRlc2NyaXB0aW9uIiwicmVnZW5lcmF0ZSIsInByb2Nlc3MiLCJCQUJFTF9FTlYiLCJndWxwIiwic3JjIiwicGlwZSIsImZpbGUiLCJjb250ZW50cyIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsImNvZGUiLCJkZXN0IiwiZWplY3QiLCJ0ZXJtIiwicHJvbXB0IiwidHlwZSIsIm5hbWUiLCJtZXNzYWdlIiwiZGVmYXVsdCIsInRoZW4iLCJhbnN3ZXJzIiwiY29uZmlybSIsImxvZyIsImVycm9yIiwic3RkZXJyIiwiZGVsdGExIiwiZmlsZXMiLCJ0byIsInBhY2thZ2UiLCJkZXNjIiwicmVwbyIsInVybCIsImRlbHRhMiIsImRlYnVnIiwiYWRkcmVzcyIsInJlbW90ZVJvb3QiLCJkZWx0YTMiLCJsZW5ndGgiLCJFcnJvciIsImdpdGlnbm9yZSIsImluc3RhbGxUeXBlcyIsIl9fZGlybmFtZSIsImluZm8iLCJlcnIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQVNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsTUFBTUEsS0FBSyxHQUFHLEVBQWQ7QUFDQSxNQUFNQyxjQUFjLEdBQUcsWUFBdkI7QUFFQUQsS0FBSyxDQUFDRSxrQkFBTixHQUE0QixHQUFFRCxjQUFlLGFBQTdDO0FBQ0FELEtBQUssQ0FBQ0csT0FBTixHQUFnQixRQUFoQjtBQUNBSCxLQUFLLENBQUNJLFdBQU4sR0FBb0IsY0FBcEI7QUFDQUosS0FBSyxDQUFDSyxVQUFOLEdBQW1CLHFCQUFuQjtBQUNBTCxLQUFLLENBQUNNLGNBQU4sR0FBdUIsMEJBQXZCO0FBQ0FOLEtBQUssQ0FBQ08sR0FBTixHQUFZLE1BQVo7QUFDQVAsS0FBSyxDQUFDUSxPQUFOLEdBQWdCLFVBQWhCO0FBQ0FSLEtBQUssQ0FBQ1MsYUFBTixHQUFzQixNQUF0QjtBQUNBVCxLQUFLLENBQUNVLFNBQU4sR0FBa0IsWUFBbEI7QUFDQVYsS0FBSyxDQUFDVyxlQUFOLEdBQXdCLG1CQUF4QjtBQUVBWCxLQUFLLENBQUNZLFlBQU4sR0FBcUIsQ0FDaEIsR0FBRVosS0FBSyxDQUFDRyxPQUFRLE9BREEsQ0FBckI7QUFJQSxNQUFNVSxVQUFVLEdBQUk7Ozs7T0FBcEI7QUFNQSxNQUFNQyxhQUFhLEdBQUcscUJBQVVDLFlBQVYsQ0FBdEI7O0FBSUEsTUFBTUMsVUFBVSxHQUFHLFlBQVk7QUFDM0IsUUFBTUMsT0FBTyxHQUFHLDhCQUFlLE1BQU1ILGFBQWEsQ0FBQ2QsS0FBSyxDQUFDRSxrQkFBUCxDQUFsQyxFQUFoQjtBQUVBLHlCQUFLLHNCQUFxQkQsY0FBZSxPQUFNZ0IsT0FBTyxDQUFDQyxJQUFSLENBQWEsS0FBYixDQUFvQixHQUFuRTtBQUNBLG9CQUFJRCxPQUFKLEVBQWE7QUFBRUUsSUFBQUEsR0FBRyxFQUFFbEI7QUFBUCxHQUFiO0FBQ0gsQ0FMRDs7O0FBT0FlLFVBQVUsQ0FBQ0ksV0FBWCxHQUEwQixjQUFhbkIsY0FBZSxnQ0FBdEQ7O0FBUUEsTUFBTW9CLFVBQVUsR0FBRyxNQUFNO0FBQ3JCLHlCQUFLLDBCQUF5QnJCLEtBQUssQ0FBQ1ksWUFBTixDQUFtQk0sSUFBbkIsQ0FBd0IsS0FBeEIsQ0FBK0IsR0FBN0Q7QUFFQUksRUFBQUEsT0FBTyxDQUFDZixHQUFSLENBQVlnQixTQUFaLEdBQXdCLFdBQXhCO0FBRUEsU0FBT0MsY0FBS0MsR0FBTCxDQUFTekIsS0FBSyxDQUFDWSxZQUFmLEVBQ0tjLElBREwsQ0FDVSxzQkFBSUMsSUFBSSxJQUFJQSxJQUFJLENBQUNDLFFBQUwsR0FBZ0JDLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZakIsVUFBVSxHQUFHLHlCQUFNYyxJQUFJLENBQUNDLFFBQUwsQ0FBY0csUUFBZCxFQUFOLEVBQWdDQyxJQUF6RCxDQUE1QixDQURWLEVBRUtOLElBRkwsQ0FFVUYsY0FBS1MsSUFBTCxDQUFVLEdBQVYsQ0FGVixDQUFQO0FBR0gsQ0FSRDs7O0FBVUFaLFVBQVUsQ0FBQ0QsV0FBWCxHQUF5Qix5RkFBekI7O0FBSUEsTUFBTWMsS0FBSyxHQUFHLE1BQU1DLGtCQUFLQyxNQUFMLENBQVksQ0FDNUI7QUFDSUMsRUFBQUEsSUFBSSxFQUFFLE9BRFY7QUFFSUMsRUFBQUEsSUFBSSxFQUFFLGNBRlY7QUFHSUMsRUFBQUEsT0FBTyxFQUFFO0FBSGIsQ0FENEIsRUFNNUI7QUFDSUYsRUFBQUEsSUFBSSxFQUFFLE9BRFY7QUFFSUMsRUFBQUEsSUFBSSxFQUFFLGNBRlY7QUFHSUMsRUFBQUEsT0FBTyxFQUFFO0FBSGIsQ0FONEIsRUFXNUI7QUFDSUYsRUFBQUEsSUFBSSxFQUFFLE9BRFY7QUFFSUMsRUFBQUEsSUFBSSxFQUFFLGtCQUZWO0FBR0lDLEVBQUFBLE9BQU8sRUFBRTtBQUhiLENBWDRCLEVBZ0I1QjtBQUNJRixFQUFBQSxJQUFJLEVBQUUsT0FEVjtBQUVJQyxFQUFBQSxJQUFJLEVBQUUsZUFGVjtBQUdJQyxFQUFBQSxPQUFPLEVBQUUsZ0ZBSGI7QUFJSUMsRUFBQUEsT0FBTyxFQUFFO0FBSmIsQ0FoQjRCLEVBc0I1QjtBQUNJSCxFQUFBQSxJQUFJLEVBQUUsT0FEVjtBQUVJQyxFQUFBQSxJQUFJLEVBQUUsV0FGVjtBQUdJQyxFQUFBQSxPQUFPLEVBQUUsZ0VBSGI7QUFJSUMsRUFBQUEsT0FBTyxFQUFFO0FBSmIsQ0F0QjRCLEVBNEI1QjtBQUNJSCxFQUFBQSxJQUFJLEVBQUUsT0FEVjtBQUVJQyxFQUFBQSxJQUFJLEVBQUUsa0JBRlY7QUFHSUMsRUFBQUEsT0FBTyxFQUFFO0FBSGIsQ0E1QjRCLEVBaUM1QjtBQUNJRixFQUFBQSxJQUFJLEVBQUUsU0FEVjtBQUVJQyxFQUFBQSxJQUFJLEVBQUUsY0FGVjtBQUdJQyxFQUFBQSxPQUFPLEVBQUUsMkRBSGI7QUFJSUMsRUFBQUEsT0FBTyxFQUFFO0FBSmIsQ0FqQzRCLEVBdUM1QjtBQUNJSCxFQUFBQSxJQUFJLEVBQUUsU0FEVjtBQUVJQyxFQUFBQSxJQUFJLEVBQUUsU0FGVjtBQUdJQyxFQUFBQSxPQUFPLEVBQUUsNEJBSGI7QUFJSUMsRUFBQUEsT0FBTyxFQUFFO0FBSmIsQ0F2QzRCLENBQVosRUE2Q2pCQyxJQTdDaUIsQ0E2Q1osTUFBTUMsT0FBTixJQUFpQjtBQUNyQixNQUFHLENBQUNBLE9BQU8sQ0FBQ0MsT0FBWixFQUNJLE9BQU9DLGtCQUFJQyxLQUFKLENBQVUsZUFBVixDQUFQOztBQUVKLE1BQUk7QUFDQSxVQUFNLDhCQUFXLE1BQUs3QyxLQUFLLENBQUNRLE9BQVEsSUFBR1IsS0FBSyxDQUFDTyxHQUFJLEVBQTNDLEVBQThDdUMsTUFBOUMsQ0FBcURwQixJQUFyRCxDQUEwREosT0FBTyxDQUFDd0IsTUFBbEUsQ0FBTjtBQUNBLFVBQU0sOEJBQVcsTUFBSzlDLEtBQUssQ0FBQ00sY0FBZSxJQUFHTixLQUFLLENBQUNLLFVBQVcsRUFBekQsRUFBNER5QyxNQUE1RCxDQUFtRXBCLElBQW5FLENBQXdFSixPQUFPLENBQUN3QixNQUFoRixDQUFOO0FBRUEsVUFBTUMsTUFBTSxHQUFHLDRCQUFjO0FBQ3pCQyxNQUFBQSxLQUFLLEVBQUVoRCxLQUFLLENBQUNJLFdBRFk7QUFFekIwQixNQUFBQSxJQUFJLEVBQUUsQ0FBQyxtQkFBRCxFQUFzQiwwQkFBdEIsRUFBa0Qsa0JBQWxELENBRm1CO0FBR3pCbUIsTUFBQUEsRUFBRSxFQUFFLENBQUUsTUFBS1AsT0FBTyxDQUFDUSxPQUFSLENBQWdCWixJQUFLLEdBQTVCLEVBQWlDLE1BQUtJLE9BQU8sQ0FBQ1EsT0FBUixDQUFnQkMsSUFBSyxHQUEzRCxFQUFnRSxNQUFLVCxPQUFPLENBQUNRLE9BQVIsQ0FBZ0JFLElBQWhCLENBQXFCQyxHQUFJLEdBQTlGO0FBSHFCLEtBQWQsQ0FBZjtBQU1BLFVBQU1DLE1BQU0sR0FBRyw0QkFBYztBQUN6Qk4sTUFBQUEsS0FBSyxFQUFFaEQsS0FBSyxDQUFDSyxVQURZO0FBRXpCeUIsTUFBQUEsSUFBSSxFQUFFLENBQUMsc0JBQUQsRUFBeUIseUJBQXpCLEVBQW9ELGtCQUFwRCxDQUZtQjtBQUd6Qm1CLE1BQUFBLEVBQUUsRUFBRSxDQUFFLE1BQUtQLE9BQU8sQ0FBQ2EsS0FBUixDQUFjQyxPQUFRLEdBQTdCLEVBQWtDLE1BQUtkLE9BQU8sQ0FBQ2EsS0FBUixDQUFjRSxVQUFXLEdBQWhFLEVBQXFFLE1BQUtmLE9BQU8sQ0FBQ2EsS0FBUixDQUFjRixHQUFJLEdBQTVGO0FBSHFCLEtBQWQsQ0FBZjtBQU1BLFVBQU1LLE1BQU0sR0FBRyw0QkFBYztBQUN6QlYsTUFBQUEsS0FBSyxFQUFFaEQsS0FBSyxDQUFDVSxTQURZO0FBRXpCb0IsTUFBQUEsSUFBSSxFQUFFLG1CQUZtQjtBQUd6Qm1CLE1BQUFBLEVBQUUsRUFBRTtBQUhxQixLQUFkLENBQWY7QUFNQSxRQUFHLENBQUNGLE1BQU0sQ0FBQ1ksTUFBWCxFQUNJLE1BQU0sSUFBSUMsS0FBSixDQUFXLDRDQUEyQzVELEtBQUssQ0FBQ0ksV0FBWSxHQUF4RSxDQUFOO0FBRUosUUFBRyxDQUFDa0QsTUFBTSxDQUFDSyxNQUFYLEVBQ0ksTUFBTSxJQUFJQyxLQUFKLENBQVcsNENBQTJDNUQsS0FBSyxDQUFDSyxVQUFXLEdBQXZFLENBQU47QUFFSixRQUFHLENBQUNxRCxNQUFNLENBQUNDLE1BQVgsRUFDSSxNQUFNLElBQUlDLEtBQUosQ0FBVyw0Q0FBMkM1RCxLQUFLLENBQUM2RCxTQUFVLEdBQXRFLENBQU47QUFFSixRQUFHbkIsT0FBTyxDQUFDb0IsWUFBWCxFQUNJLE1BQU0sOEJBQVUsdUJBQVYsRUFBbUNoQixNQUFuQyxDQUEwQ3BCLElBQTFDLENBQStDSixPQUFPLENBQUN3QixNQUF2RCxDQUFOO0FBRUosVUFBTSw4QkFBVyxTQUFROUMsS0FBSyxDQUFDVyxlQUFnQixFQUF6QyxFQUE0Q21DLE1BQTVDLENBQW1EcEIsSUFBbkQsQ0FBd0RKLE9BQU8sQ0FBQ3dCLE1BQWhFLENBQU47QUFDQSxVQUFNLDhCQUFVLG1CQUFWLEVBQStCQSxNQUEvQixDQUFzQ3BCLElBQXRDLENBQTJDSixPQUFPLENBQUN3QixNQUFuRCxDQUFOO0FBQ0EsVUFBTSw4QkFBVyxpQkFBWCxFQUE2QkEsTUFBN0IsQ0FBb0NwQixJQUFwQyxDQUF5Q0osT0FBTyxDQUFDd0IsTUFBakQsQ0FBTjtBQUVBLFVBQU0sOEJBQVcsZUFBYyxpQkFBVWlCLFNBQVYsRUFBcUJ6QixJQUFLLElBQUdJLE9BQU8sQ0FBQ1EsT0FBUixDQUFnQlosSUFBSyxFQUEzRSxFQUE4RVEsTUFBOUUsQ0FBcUZwQixJQUFyRixDQUEwRkosT0FBTyxDQUFDd0IsTUFBbEcsQ0FBTjs7QUFFQUYsc0JBQUlvQixJQUFKLENBQVMsZ0NBQVQ7O0FBQ0EsMkJBQUsscVBBQUw7QUFDSCxHQTFDRCxDQTRDQSxPQUFNQyxHQUFOLEVBQVc7QUFDUHJCLHNCQUFJQyxLQUFKLENBQVcsVUFBU29CLEdBQUcsQ0FBQ2xDLFFBQUosRUFBZSxFQUFuQztBQUNIO0FBQ0osQ0FoR21CLENBQXBCOzs7QUFrR0FHLEtBQUssQ0FBQ2QsV0FBTixHQUFvQiwrREFBcEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBAZmxvdyAqL1xuXG4vLyA/IFRvIHJlZ2VuZXJhdGUgdGhpcyBmaWxlIChpLmUuIGlmIHlvdSBjaGFuZ2VkIGl0IGFuZCB3YW50IHlvdXIgY2hhbmdlcyB0b1xuLy8gPyBiZSBwZXJtYW5lbnQpLCBjYWxsIGBucG0gcnVuIHJlZ2VuZXJhdGVgIGFmdGVyd2FyZHNcblxuLy8gISBCZSBzdXJlIHRoYXQgdGFza3MgZXhwZWN0ZWQgdG8gcnVuIG9uIG5wbSBpbnN0YWxsIChtYXJrZWQgQGRlcGVuZGVudCkgaGF2ZVxuLy8gISBhbGwgcmVxdWlyZWQgcGFja2FnZXMgbGlzdGVkIHVuZGVyIFwiZGVwZW5kZW5jaWVzXCIgaW5zdGVhZCBvZlxuLy8gISBcImRldkRlcGVuZGVuY2llc1wiIGluIHRoaXMgcHJvamVjdCdzIHBhY2thZ2UuanNvblxuXG5pbXBvcnQgeyByZWFkRmlsZSB9IGZyb20gJ2ZzJ1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSAndXRpbCdcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnXG5pbXBvcnQgdGFwIGZyb20gJ2d1bHAtdGFwJ1xuaW1wb3J0IGRlbCBmcm9tICdkZWwnXG5pbXBvcnQgbG9nIGZyb20gJ2ZhbmN5LWxvZydcbmltcG9ydCBwYXJzZUdpdElnbm9yZSBmcm9tICdwYXJzZS1naXRpZ25vcmUnXG5pbXBvcnQgeyB0cmFuc2Zvcm1TeW5jIGFzIGJhYmVsIH0gZnJvbSAnQGJhYmVsL2NvcmUnXG5pbXBvcnQgeyBleGVjQXN5bmMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJ1xuaW1wb3J0IHsgcGFyc2UgYXMgcGFyc2VQYXRoIH0gZnJvbSAncGF0aCdcbmltcG9ydCB0ZXJtIGZyb20gJ2lucXVpcmVyJ1xuaW1wb3J0IHJlcGxhY2VJbkZpbGUgZnJvbSAncmVwbGFjZS1pbi1maWxlJ1xuXG5jb25zdCBwYXRocyA9IHt9O1xuY29uc3QgRkxPV19UWVBFU19ESVIgPSAnZmxvdy10eXBlZCc7XG5cbnBhdGhzLmZsb3dUeXBlZEdpdElnbm9yZSA9IGAke0ZMT1dfVFlQRVNfRElSfS8uZ2l0aWdub3JlYDtcbnBhdGhzLmNvbmZpZ3MgPSAnY29uZmlnJztcbnBhdGhzLnBhY2thZ2VKc29uID0gJ3BhY2thZ2UuanNvbic7XG5wYXRocy5sYXVuY2hKc29uID0gJy52c2NvZGUvbGF1bmNoLmpzb24nO1xucGF0aHMubGF1bmNoSnNvbkRpc3QgPSAnLnZzY29kZS9sYXVuY2guZGlzdC5qc29uJztcbnBhdGhzLmVudiA9ICcuZW52JztcbnBhdGhzLmVudkRpc3QgPSAnZGlzdC5lbnYnO1xucGF0aHMuZ2l0UHJvamVjdERpciA9ICcuZ2l0JztcbnBhdGhzLmdpdElnbm9yZSA9ICcuZ2l0aWdub3JlJztcbnBhdGhzLnBhY2thZ2VMb2NrSnNvbiA9ICdwYWNrYWdlLWxvY2suanNvbic7XG5cbnBhdGhzLnJlZ2VuVGFyZ2V0cyA9IFtcbiAgICBgJHtwYXRocy5jb25maWdzfS8qLmpzYFxuXTtcblxuY29uc3QgQ0xJX0JBTk5FUiA9IGAvKipcbiogISEhIERPIE5PVCBFRElUIFRISVMgRklMRSBESVJFQ1RMWSAhISFcbiogISBUaGlzIGZpbGUgaGFzIGJlZW4gZ2VuZXJhdGVkIGF1dG9tYXRpY2FsbHkuIFNlZSB0aGUgKi5iYWJlbC5qcyB2ZXJzaW9uIG9mXG4qICEgdGhpcyBmaWxlIHRvIG1ha2UgcGVybWFuZW50IG1vZGlmaWNhdGlvbnMgKGluIGNvbmZpZy8pXG4qL1xcblxcbmA7XG5cbmNvbnN0IHJlYWRGaWxlQXN5bmMgPSBwcm9taXNpZnkocmVhZEZpbGUpO1xuXG4vLyAqIENMRUFOVFlQRVNcblxuY29uc3QgY2xlYW5UeXBlcyA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB0YXJnZXRzID0gcGFyc2VHaXRJZ25vcmUoYXdhaXQgcmVhZEZpbGVBc3luYyhwYXRocy5mbG93VHlwZWRHaXRJZ25vcmUpKTtcblxuICAgIGxvZyhgRGVsZXRpb24gdGFyZ2V0cyBAICR7RkxPV19UWVBFU19ESVJ9LzogXCIke3RhcmdldHMuam9pbignXCIgXCInKX1cImApO1xuICAgIGRlbCh0YXJnZXRzLCB7IGN3ZDogRkxPV19UWVBFU19ESVIgfSk7XG59O1xuXG5jbGVhblR5cGVzLmRlc2NyaXB0aW9uID0gYFJlc2V0cyB0aGUgJHtGTE9XX1RZUEVTX0RJUn0gZGlyZWN0b3J5IHRvIGEgcHJpc3RpbmUgc3RhdGVgO1xuXG4vLyAqIFJFR0VORVJBVEVcblxuLy8gPyBJZiB5b3UgY2hhbmdlIHRoaXMgZnVuY3Rpb24sIHJ1biBgbnBtIHJ1biByZWdlbmVyYXRlYCB0d2ljZTogb25jZSB0b1xuLy8gPyBjb21waWxlIHRoaXMgbmV3IGZ1bmN0aW9uIGFuZCBvbmNlIGFnYWluIHRvIGNvbXBpbGUgaXRzZWxmIHdpdGggdGhlIG5ld2x5XG4vLyA/IGNvbXBpbGVkIGxvZ2ljLiBJZiB0aGVyZSBpcyBhbiBlcnJvciB0aGF0IHByZXZlbnRzIHJlZ2VuZXJhdGlvbiwgeW91IGNhblxuLy8gPyBydW4gYG5wbSBydW4gcmVnZW5lcmF0ZWAgYmVmb3JlIGBucG0gcnVuIHJlZ2VuZXJhdGVgIGluc3RlYWQuXG5jb25zdCByZWdlbmVyYXRlID0gKCkgPT4ge1xuICAgIGxvZyhgUmVnZW5lcmF0aW5nIHRhcmdldHM6IFwiJHtwYXRocy5yZWdlblRhcmdldHMuam9pbignXCIgXCInKX1cImApO1xuXG4gICAgcHJvY2Vzcy5lbnYuQkFCRUxfRU5WID0gJ2dlbmVyYXRvcic7XG5cbiAgICByZXR1cm4gZ3VscC5zcmMocGF0aHMucmVnZW5UYXJnZXRzKVxuICAgICAgICAgICAgICAgLnBpcGUodGFwKGZpbGUgPT4gZmlsZS5jb250ZW50cyA9IEJ1ZmZlci5mcm9tKENMSV9CQU5ORVIgKyBiYWJlbChmaWxlLmNvbnRlbnRzLnRvU3RyaW5nKCkpLmNvZGUpKSlcbiAgICAgICAgICAgICAgIC5waXBlKGd1bHAuZGVzdCgnLicpKTtcbn07XG5cbnJlZ2VuZXJhdGUuZGVzY3JpcHRpb24gPSAnSW52b2tlcyBiYWJlbCBvbiB0aGUgZmlsZXMgaW4gY29uZmlnLCB0cmFuc3BpbGluZyB0aGVtIGludG8gdGhlaXIgcHJvamVjdCByb290IHZlcnNpb25zJztcblxuLy8gKiBFSkVDVFxuXG5jb25zdCBlamVjdCA9ICgpID0+IHRlcm0ucHJvbXB0KFtcbiAgICB7XG4gICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgIG5hbWU6ICdwYWNrYWdlLm5hbWUnLFxuICAgICAgICBtZXNzYWdlOiAnW3BhY2thZ2UuanNvbl0gU3BlY2lmeSBuYW1lIGZvciB0aGlzIHByb2plY3QgKG11c3QgYmUgdmFsaWQgYXMgYSBkaXJlY3RvcnkgbmFtZSknXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgIG5hbWU6ICdwYWNrYWdlLmRlc2MnLFxuICAgICAgICBtZXNzYWdlOiAnW3BhY2thZ2UuanNvbl0gVmVyeSBicmllZmx5IGRlc2NyaWJlIHRoaXMgcHJvamVjdCcsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgIG5hbWU6ICdwYWNrYWdlLnJlcG8udXJsJyxcbiAgICAgICAgbWVzc2FnZTogJ1twYWNrYWdlLmpzb25dIFNwZWNpZnkgYSBnaXQgcmVwb3NpdG9yeSBVUkwnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgIG5hbWU6ICdkZWJ1Zy5hZGRyZXNzJyxcbiAgICAgICAgbWVzc2FnZTogJ1tsYXVuY2guanNvbl0gU3BlY2lmeSB5b3VyIGRldi9yZW1vdGUvc2VydmVyIGlwIGFkZHJlc3MgKHRoZSBvbmUgcnVubmluZyBub2RlKScsXG4gICAgICAgIGRlZmF1bHQ6ICcxOTIuMTY4LjExNS41J1xuICAgIH0sXG4gICAge1xuICAgICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgICBuYW1lOiAnZGVidWcudXJsJyxcbiAgICAgICAgbWVzc2FnZTogJ1tsYXVuY2guanNvbl0gU3BlY2lmeSB0aGUgVVJMIGVudHJ5IHBvaW50IGZvciB5b3VyIGFwcGxpY2F0aW9uJyxcbiAgICAgICAgZGVmYXVsdDogJ2h0dHA6Ly9kZXYubG9jYWw6ODAnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICAgIG5hbWU6ICdkZWJ1Zy5yZW1vdGVSb290JyxcbiAgICAgICAgbWVzc2FnZTogXCJbbGF1bmNoLmpzb25dIFNwZWNpZnkgYW4gKmFic29sdXRlKiBwYXRoIHRvIHRoaXMgcHJvamVjdCdzIHJvb3Qgb24gcmVtb3RlL3NlcnZlclwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHR5cGU6ICdjb25maXJtJyxcbiAgICAgICAgbmFtZTogJ2luc3RhbGxUeXBlcycsXG4gICAgICAgIG1lc3NhZ2U6ICdEbyB5b3Ugd2FudCB0byBpbnN0YWxsIEZsb3cgdHlwZXMgZm9yIGFsbCBsb2NhbCBwYWNrYWdlcz8nLFxuICAgICAgICBkZWZhdWx0OiB0cnVlXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHR5cGU6ICdjb25maXJtJyxcbiAgICAgICAgbmFtZTogJ2NvbmZpcm0nLFxuICAgICAgICBtZXNzYWdlOiAnRG9lcyBldmVyeXRoaW5nIGxvb2sgZ29vZD8nLFxuICAgICAgICBkZWZhdWx0OiBmYWxzZVxuICAgIH1cbl0pLnRoZW4oYXN5bmMgYW5zd2VycyA9PiB7XG4gICAgaWYoIWFuc3dlcnMuY29uZmlybSlcbiAgICAgICAgcmV0dXJuIGxvZy5lcnJvcignVGFzayBhYm9ydGVkIScpO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZXhlY0FzeW5jKGBtdiAke3BhdGhzLmVudkRpc3R9ICR7cGF0aHMuZW52fWApLnN0ZGVyci5waXBlKHByb2Nlc3Muc3RkZXJyKTtcbiAgICAgICAgYXdhaXQgZXhlY0FzeW5jKGBtdiAke3BhdGhzLmxhdW5jaEpzb25EaXN0fSAke3BhdGhzLmxhdW5jaEpzb259YCkuc3RkZXJyLnBpcGUocHJvY2Vzcy5zdGRlcnIpO1xuXG4gICAgICAgIGNvbnN0IGRlbHRhMSA9IHJlcGxhY2VJbkZpbGUoe1xuICAgICAgICAgICAgZmlsZXM6IHBhdGhzLnBhY2thZ2VKc29uLFxuICAgICAgICAgICAgZnJvbTogWy8oXCJuYW1lXCI6ID8pXCIuKj9cIi9nLCAvXCIoZGVzY3JpcHRpb25cIjogPylcIi4qP1wiL2csIC8oXCJ1cmxcIjogPylcIi4qP1wiL2ddLFxuICAgICAgICAgICAgdG86IFtgJDFcIiR7YW5zd2Vycy5wYWNrYWdlLm5hbWV9XCJgLCBgJDFcIiR7YW5zd2Vycy5wYWNrYWdlLmRlc2N9XCJgLCBgJDFcIiR7YW5zd2Vycy5wYWNrYWdlLnJlcG8udXJsfVwiYF0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGRlbHRhMiA9IHJlcGxhY2VJbkZpbGUoe1xuICAgICAgICAgICAgZmlsZXM6IHBhdGhzLmxhdW5jaEpzb24sXG4gICAgICAgICAgICBmcm9tOiBbLyhcImFkZHJlc3NcIjogPylcIi4qP1wiL2csIC8oXCJyZW1vdGVSb290XCI6ID8pXCIuKj9cIi9nLCAvKFwidXJsXCI6ID8pXCIuKj9cIi9nXSxcbiAgICAgICAgICAgIHRvOiBbYCQxXCIke2Fuc3dlcnMuZGVidWcuYWRkcmVzc31cImAsIGAkMVwiJHthbnN3ZXJzLmRlYnVnLnJlbW90ZVJvb3R9XCJgLCBgJDFcIiR7YW5zd2Vycy5kZWJ1Zy51cmx9XCJgXSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgZGVsdGEzID0gcmVwbGFjZUluRmlsZSh7XG4gICAgICAgICAgICBmaWxlczogcGF0aHMuZ2l0SWdub3JlLFxuICAgICAgICAgICAgZnJvbTogJ3BhY2thZ2UtbG9jay5qc29uJyxcbiAgICAgICAgICAgIHRvOiAnJyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYoIWRlbHRhMS5sZW5ndGgpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIHdhcyBhbiBlcnJvciBhdHRlbXB0aW5nIHRvIGFjY2VzcyBcIiR7cGF0aHMucGFja2FnZUpzb259XCJgKTtcblxuICAgICAgICBpZighZGVsdGEyLmxlbmd0aClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlcmUgd2FzIGFuIGVycm9yIGF0dGVtcHRpbmcgdG8gYWNjZXNzIFwiJHtwYXRocy5sYXVuY2hKc29ufVwiYCk7XG5cbiAgICAgICAgaWYoIWRlbHRhMy5sZW5ndGgpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIHdhcyBhbiBlcnJvciBhdHRlbXB0aW5nIHRvIGFjY2VzcyBcIiR7cGF0aHMuZ2l0aWdub3JlfVwiYCk7XG5cbiAgICAgICAgaWYoYW5zd2Vycy5pbnN0YWxsVHlwZXMpXG4gICAgICAgICAgICBhd2FpdCBleGVjQXN5bmMoJ25wbSBydW4gaW5zdGFsbC10eXBlcycpLnN0ZGVyci5waXBlKHByb2Nlc3Muc3RkZXJyKTtcblxuICAgICAgICBhd2FpdCBleGVjQXN5bmMoYHJtIC1mICR7cGF0aHMucGFja2FnZUxvY2tKc29ufWApLnN0ZGVyci5waXBlKHByb2Nlc3Muc3RkZXJyKTtcbiAgICAgICAgYXdhaXQgZXhlY0FzeW5jKCdlY2hvIFwicm0gLWYgLmdpdFwiJykuc3RkZXJyLnBpcGUocHJvY2Vzcy5zdGRlcnIpO1xuICAgICAgICBhd2FpdCBleGVjQXN5bmMoYGVjaG8gXCJnaXQgaW5pdFwiYCkuc3RkZXJyLnBpcGUocHJvY2Vzcy5zdGRlcnIpO1xuXG4gICAgICAgIGF3YWl0IGV4ZWNBc3luYyhgY2QgLi4gJiYgbXYgJHtwYXJzZVBhdGgoX19kaXJuYW1lKS5uYW1lfSAke2Fuc3dlcnMucGFja2FnZS5uYW1lfWApLnN0ZGVyci5waXBlKHByb2Nlc3Muc3RkZXJyKTtcblxuICAgICAgICBsb2cuaW5mbygnQm9pbGVycGxhdGUgZWplY3Rpb24gY29tcGxldGUhJyk7XG4gICAgICAgIGxvZyhgTmV4dCBzdGVwczpcXG5cXHQtIElmIHlvdSdyZSBnb2luZyB0byBob3N0IHRoaXMgcHJvamVjdCBvbiBHaXRodWIvR2l0bGFiLCBiZWdpbiB0aGF0IHByb2Nlc3Mgbm93XFxuXFx0LSBDaGVjayBvdmVyIHBhY2thZ2UuanNvbiBmb3IgYWNjdXJhY3k7IHJlbW92ZSBhbnkgdW5uZWNlc3NhcnkgZGVwZW5kZW5jaWVzL2RldkRlcGVuZGVuY2llc1xcblxcdC0gTG9vayBvdmVyIC5lbnYgYW5kIGNvbmZpZ3VyZSBpdCB0byB5b3VyIGxpa2luZ1xcbmApO1xuICAgIH1cblxuICAgIGNhdGNoKGVycikge1xuICAgICAgICBsb2cuZXJyb3IoYEVSUk9SOiAke2Vyci50b1N0cmluZygpfWApO1xuICAgIH1cbn0pO1xuXG5lamVjdC5kZXNjcmlwdGlvbiA9ICdBc3Npc3RzIGluIGNvbmZpZ3VyaW5nIHRoZSBib2lsZXJwbGF0ZSB0byBiZSBzb21ldGhpbmcgdXNlZnVsJztcblxuZXhwb3J0IHsgZWplY3QsIHJlZ2VuZXJhdGUsIGNsZWFuVHlwZXMgfTtcbiJdfQ==